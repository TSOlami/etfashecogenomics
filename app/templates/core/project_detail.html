{% extends 'base.html' %}

{% block title %}{{ project.name }} - EcoGenomics Suite{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Project Header -->
    <div class="bg-white rounded-lg shadow mb-8">
        <div class="px-6 py-4 border-b border-gray-200">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">{{ project.name }}</h1>
                    <p class="text-gray-600 mt-1">{{ project.description|default:"No description provided." }}</p>
                </div>
                <div class="flex items-center space-x-3">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium 
                        {% if project.status == 'active' %}bg-green-100 text-green-800
                        {% elif project.status == 'completed' %}bg-blue-100 text-blue-800
                        {% else %}bg-gray-100 text-gray-800{% endif %}">
                        {{ project.get_status_display }}
                    </span>
                    <button onclick="editProject()" class="border border-gray-300 text-gray-700 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-50 transition-colors">
                        Edit Project
                    </button>
                </div>
            </div>
        </div>
        
        <div class="px-6 py-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Owner</label>
                    <p class="mt-1 text-sm text-gray-900">{{ project.owner.full_name }}</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Created</label>
                    <p class="mt-1 text-sm text-gray-900">{{ project.created_at|date:"F j, Y" }}</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Last Updated</label>
                    <p class="mt-1 text-sm text-gray-900">{{ project.updated_at|date:"F j, Y g:i A" }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Project Tabs -->
    <div class="bg-white rounded-lg shadow">
        <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-8 px-6">
                <button onclick="showTab('overview')" id="tab-overview" class="tab-button active py-4 px-1 border-b-2 border-emerald-500 font-medium text-sm text-emerald-600">
                    Overview
                </button>
                <button onclick="showTab('files')" id="tab-files" class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    Data Files
                </button>
                <button onclick="showTab('analyses')" id="tab-analyses" class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    Analyses
                </button>
                <button onclick="showTab('collaborators')" id="tab-collaborators" class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    Collaborators
                </button>
            </nav>
        </div>

        <!-- Overview Tab -->
        <div id="content-overview" class="tab-content p-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Quick Stats -->
                <div>
                    <h3 class="text-lg font-medium text-gray-900 mb-4">Project Statistics</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-blue-100 rounded-md flex items-center justify-center mr-3">
                                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                </div>
                                <span class="text-sm font-medium text-gray-700">Data Files</span>
                            </div>
                            <span class="text-lg font-semibold text-gray-900">{{ project.data_files.count }}</span>
                        </div>
                        
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-green-100 rounded-md flex items-center justify-center mr-3">
                                    <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                </div>
                                <span class="text-sm font-medium text-gray-700">Analyses</span>
                            </div>
                            <span class="text-lg font-semibold text-gray-900">{{ project.analysis_jobs.count }}</span>
                        </div>
                        
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-purple-100 rounded-md flex items-center justify-center mr-3">
                                    <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                                    </svg>
                                </div>
                                <span class="text-sm font-medium text-gray-700">Collaborators</span>
                            </div>
                            <span class="text-lg font-semibold text-gray-900">{{ project.collaborators.count }}</span>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div>
                    <h3 class="text-lg font-medium text-gray-900 mb-4">Recent Activity</h3>
                    <div class="space-y-3">
                        <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg">
                            <div class="w-2 h-2 bg-green-400 rounded-full mt-2"></div>
                            <div>
                                <p class="text-sm text-gray-900">Project created</p>
                                <p class="text-xs text-gray-500">{{ project.created_at|timesince }} ago</p>
                            </div>
                        </div>
                        
                        {% if project.updated_at != project.created_at %}
                        <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg">
                            <div class="w-2 h-2 bg-blue-400 rounded-full mt-2"></div>
                            <div>
                                <p class="text-sm text-gray-900">Project updated</p>
                                <p class="text-xs text-gray-500">{{ project.updated_at|timesince }} ago</p>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Files Tab -->
        <div id="content-files" class="tab-content hidden p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-medium text-gray-900">Data Files</h3>
                <button onclick="uploadFile()" class="eco-gradient text-white px-4 py-2 rounded-md text-sm font-medium hover:opacity-90 transition-opacity">
                    Upload File
                </button>
            </div>
            
            {% if project.data_files.all %}
                <div class="space-y-3">
                    {% for file in project.data_files.all %}
                    <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-900">{{ file.name }}</p>
                                <p class="text-xs text-gray-500">{{ file.file_size|filesizeformat }} • {{ file.get_file_type_display }} • {{ file.uploaded_at|date:"M j, Y" }}</p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button class="text-emerald-600 hover:text-emerald-900 text-sm font-medium">Download</button>
                            <button class="text-red-600 hover:text-red-900 text-sm font-medium">Delete</button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-8">
                    <p class="text-gray-500 mb-4">No files uploaded yet.</p>
                    <button onclick="uploadFile()" class="eco-gradient text-white px-6 py-2 rounded-md font-medium hover:opacity-90 transition-opacity">
                        Upload Your First File
                    </button>
                </div>
            {% endif %}
        </div>

        <!-- Analyses Tab -->
        <div id="content-analyses" class="tab-content hidden p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-medium text-gray-900">Analysis Jobs</h3>
                <button onclick="startAnalysis()" class="eco-gradient text-white px-4 py-2 rounded-md text-sm font-medium hover:opacity-90 transition-opacity">
                    New Analysis
                </button>
            </div>
            
            {% if project.analysis_jobs.all %}
                <div class="space-y-3">
                    {% for job in project.analysis_jobs.all %}
                    <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-900">{{ job.name }}</p>
                                <p class="text-xs text-gray-500">{{ job.get_analysis_type_display }} • {{ job.started_at|date:"M j, Y g:i A" }}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                                {% if job.status == 'completed' %}bg-green-100 text-green-800
                                {% elif job.status == 'running' %}bg-blue-100 text-blue-800
                                {% elif job.status == 'failed' %}bg-red-100 text-red-800
                                {% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ job.get_status_display }}
                            </span>
                            <button class="text-emerald-600 hover:text-emerald-900 text-sm font-medium">View Results</button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-8">
                    <p class="text-gray-500 mb-4">No analyses started yet.</p>
                    <button onclick="startAnalysis()" class="eco-gradient text-white px-6 py-2 rounded-md font-medium hover:opacity-90 transition-opacity">
                        Start Your First Analysis
                    </button>
                </div>
            {% endif %}
        </div>

        <!-- Collaborators Tab -->
        <div id="content-collaborators" class="tab-content hidden p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-medium text-gray-900">Collaborators</h3>
                <button onclick="addCollaborator()" class="eco-gradient text-white px-4 py-2 rounded-md text-sm font-medium hover:opacity-90 transition-opacity">
                    Add Collaborator
                </button>
            </div>
            
            <div class="space-y-3">
                <!-- Project Owner -->
                <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-gray-50">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-emerald-100 rounded-full flex items-center justify-center">
                            <span class="text-sm font-bold text-emerald-600">{{ project.owner.first_name.0 }}{{ project.owner.last_name.0 }}</span>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-900">{{ project.owner.full_name }}</p>
                            <p class="text-xs text-gray-500">{{ project.owner.email }} • Project Owner</p>
                        </div>
                    </div>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800">
                        Owner
                    </span>
                </div>
                
                <!-- Collaborators -->
                {% for collaborator in project.collaborators.all %}
                <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                            <span class="text-sm font-bold text-blue-600">{{ collaborator.first_name.0 }}{{ collaborator.last_name.0 }}</span>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-900">{{ collaborator.full_name }}</p>
                            <p class="text-xs text-gray-500">{{ collaborator.email }} • {{ collaborator.get_role_display }}</p>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            Collaborator
                        </span>
                        {% if project.owner == user %}
                        <button class="text-red-600 hover:text-red-900 text-sm font-medium">Remove</button>
                        {% endif %}
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-8">
                    <p class="text-gray-500 mb-4">No collaborators added yet.</p>
                    {% if project.owner == user %}
                    <button onclick="addCollaborator()" class="eco-gradient text-white px-6 py-2 rounded-md font-medium hover:opacity-90 transition-opacity">
                        Add Your First Collaborator
                    </button>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
function showTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
    });
    
    // Remove active class from all tab buttons
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active', 'border-emerald-500', 'text-emerald-600');
        button.classList.add('border-transparent', 'text-gray-500');
    });
    
    // Show selected tab content
    document.getElementById(`content-${tabName}`).classList.remove('hidden');
    
    // Add active class to selected tab button
    const activeButton = document.getElementById(`tab-${tabName}`);
    activeButton.classList.add('active', 'border-emerald-500', 'text-emerald-600');
    activeButton.classList.remove('border-transparent', 'text-gray-500');
}

function editProject() {
    alert('Project editing functionality will be implemented soon!');
}

function uploadFile() {
    alert('File upload functionality will be implemented soon!');
}

function startAnalysis() {
    alert('Analysis functionality will be implemented soon!');
}

function addCollaborator() {
    alert('Collaborator management functionality will be implemented soon!');
}
</script>
{% endblock %}